# 提案

## アーキテクチャの概要

本報告の提案手法の基本的な考え方は，MPIが送出する各パケットに通信パターン
をエンコードしたタグを付与し，タグに基いてネットワークでパケット制御することに
ある．図 \ref{fig:proposal-arch}に提案手法のアーキテクチャを示す．各計算ノード
は，ユーザ空間で1つ以上のMPIアプリケーションのプロセスを実行する．各MPIアプリ
ケーションはMPIライブラリを動的リンクする．カーネル空間にはタグ付けカーネルモ
ジュールが常駐し，実際のタグ付け処理を実行する．MPIライブラリとカーネルモ
ジュールは連携動作し，タグ付けに必要なMPIライブラリ内部の情報を共有する．

![提案手法のアーキテクチャ\label{fig:proposal-arch}](proposal-arch.pdf)

SDNコントローラは，MPIパケットのタグに基づいて，パケットを制御するフローエント
リを各スイッチのフローテーブルに登録する．スイッチはMPIパケットを受信すると
パケットのタグを読み取り，フローテーブルに従ってパケットを処理する．受信側の計
算ノードに隣接するスイッチは，計算ノードにパケットを転送する前に，タグを除去す
る．


## タグの格納場所の検討

提案手法では，タグをMPIパケットのMACアドレスフィールドに埋め込む．これはスイッ
チが，タグに基づくパケット制御を効率的に実行できるようにするための工夫である．
SDNスイッチが取り扱えるヘッダフィールドは，OpenFlow規格で定義されたものに限ら
れる．事前定義されていないヘッダフィールドを読み取る場合は，SDNコントローラへ
パケットを転送する必要があり，オーバーヘッドが非常に大きい．従って，タグを埋め
込むヘッダフィールドはOpenFlow規格で定義されている必要がある．MACアドレス
フィールドは，OpenFlow規格において定義されているヘッダフィールドである．

次に，スイッチに登録できるフローの数が増えるという利点がある．OpenFlowスイッチ
のフローテーブルに登録できるフローの数には制限があり，一般的なOpenFlowスイッチ
では数千個のオーダである．ところが，多くのOpenFlowスイッチはL2ヘッダフィールド
（MACアドレスとVLAN ID）のみ含むフローに関しては数万個登録できる．よって，タグ
をパケットをMACアドレスに格納すれば，フロー数の上限が増える．

## MACアドレスの書き換え方法

## タグ付けカーネルモジュール

カーネルモジュール \cite{Goyeneche1999}

